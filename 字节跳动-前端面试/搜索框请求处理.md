# æœç´¢æ¡†è¯·æ±‚å¤„ç†é—®é¢˜

## é¢˜ç›®
**æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œå‘é€å¤šæ¬¡è¯·æ±‚ï¼Œæ€ä¹ˆä¿è¯å‚æ•°ä¸è¯·æ±‚å¯¹åº”ï¼Ÿ**

å…·ä½“åœºæ™¯ï¼šä¸€ä¸ªæœç´¢è¾“å…¥æ¡†ï¼Œç”¨æˆ·å¿«é€Ÿè¾“å…¥æ—¶å¯èƒ½ä¸å°å¿ƒå‘äº†ä¸¤æ¬¡è¯·æ±‚ï¼Œæ€ä¹ˆä¿è¯è¯·æ±‚å¯¹åº”çš„å“åº”ä¸å‚æ•°ä¸€è‡´ï¼Ÿ

---

## ğŸ” é—®é¢˜èƒŒæ™¯

åœ¨æœç´¢æ¡†åœºæ™¯ä¸­ï¼Œç”¨æˆ·å¯èƒ½ä¼šï¼š
1. å¿«é€Ÿè¿ç»­è¾“å…¥ï¼š"å‘¨æ°" â†’ "å‘¨æ°ä¼¦" â†’ "å‘¨æ°"
2. ç½‘ç»œå»¶è¿Ÿï¼šå‰ä¸€ä¸ªè¯·æ±‚æ™šäºåä¸€ä¸ªè¯·æ±‚è¿”å›
3. ç«æ€æ¡ä»¶ï¼šåå‘å…ˆè‡³çš„è¯·æ±‚å“åº”è¦†ç›–æ­£ç¡®çš„æ•°æ®

**é—®é¢˜æœ¬è´¨**ï¼šé¿å…æœç´¢ç»“æœçš„é”™ä¹±ï¼Œä¿è¯ã€Œæœ€åä¸€æ¬¡è¾“å…¥ã€å¯¹åº”ã€Œæœ€åä¸€æ¬¡è¯·æ±‚ã€çš„ç»“æœã€‚

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå–æ¶ˆå‰ä¸€æ¬¡è¯·æ±‚ï¼ˆæ¨èï¼‰

```javascript
import axios from 'axios';

class SearchService {
  constructor() {
    this.cancelTokenSource = null;
    this.lastRequestTime = 0;
    this.requestDelay = 300; // é˜²æŠ–å»¶è¿Ÿ
  }

  async search(keyword) {
    // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
    if (this.cancelTokenSource) {
      this.cancelTokenSource.cancel('Request canceled by new search');
    }

    // åˆ›å»ºæ–°çš„å–æ¶ˆä»¤ç‰Œ
    this.cancelTokenSource = axios.CancelToken.source();
    
    const currentKeyword = keyword;
    const timestamp = Date.now();
    this.lastRequestTime = timestamp;

    try {
      const response = await axios.get('/api/search', {
        params: { q: keyword },
        cancelToken: this.cancelTokenSource.token,
        timeout: 5000,
      });

      // æ£€æŸ¥æ˜¯å¦ä¸ºæœ€æ–°çš„è¯·æ±‚
      if (timestamp === this.lastRequestTime) {
        return response.data;
      }
      // å¦‚æœä¸æ˜¯æœ€æ–°è¯·æ±‚ï¼Œå¿½ç•¥ç»“æœ
      return null;
    } catch (error) {
      if (axios.isCancel(error)) {
        console.log('Request canceled:', error.message);
        return null;
      }
      throw error;
    }
  }
}
```

---

### æ–¹æ¡ˆ2ï¼šè¯·æ±‚IDåŒ¹é…æ³•

```javascript
let requestId = 0;

async function searchWithRequestId(keyword) {
  const currentRequestId = ++requestId;
  const currentKeyword = keyword;

  // ä¿å­˜å½“å‰è¯·æ±‚ä¿¡æ¯
  const requestInfo = {
    id: currentRequestId,
    keyword,
    timestamp: Date.now(),
  };

  try {
    const response = await axios.get('/api/search', {
      params: { q: keyword },
    });

    // æ£€æŸ¥è¯·æ±‚æ˜¯å¦æœ‰æ•ˆ
    if (currentRequestId === requestId) {
      return response.data;
    }
    console.log('Old request result ignored');
    return null;
  } catch (error) {
    console.error('Search error:', error);
    throw error;
  }
}
```

---

### æ–¹æ¡ˆ3ï¼šé˜²æŠ– + è¯·æ±‚é˜Ÿåˆ—ï¼ˆé«˜çº§æ–¹æ¡ˆï¼‰

```javascript
import { debounce } from 'lodash';

class AdvancedSearchService {
  constructor() {
    this.pendingRequests = new Map();
    this.lastSuccessfulRequest = null;
    this.requestQueue = [];
    this.isProcessing = false;
  }

  // é˜²æŠ–æœç´¢
  debouncedSearch = debounce((keyword) => {
    this.executeSearch(keyword);
  }, 300);

  async executeSearch(keyword) {
    const requestKey = `${keyword}_${Date.now()}`;
    const controller = new AbortController();

    // ä¿å­˜è¯·æ±‚åˆ°é˜Ÿåˆ—
    this.requestQueue.push({
      key: requestKey,
      keyword,
      controller,
      timestamp: Date.now(),
    });

    // å¤„ç†é˜Ÿåˆ—
    await this.processQueue();
  }

  async processQueue() {
    if (this.isProcessing || this.requestQueue.length === 0) {
      return;
    }

    this.isProcessing = true;

    // å–æ¶ˆæ‰€æœ‰æœªå®Œæˆçš„è¯·æ±‚
    this.requestQueue.slice(0, -1).forEach((req) => {
      req.controller.abort();
    });

    // åªæ‰§è¡Œæœ€åä¸€ä¸ªè¯·æ±‚
    const lastRequest = this.requestQueue[this.requestQueue.length - 1];

    try {
      const response = await fetch(`/api/search?q=${lastRequest.keyword}`, {
        signal: lastRequest.controller.signal,
      });

      if (response.ok) {
        const data = await response.json();
        this.lastSuccessfulRequest = {
          key: lastRequest.key,
          data,
          keyword: lastRequest.keyword,
        };
        // å¤„ç†æ•°æ®æ¸²æŸ“
        this.renderResults(data);
      }
    } catch (error) {
      if (error.name === 'AbortError') {
        console.log('Request aborted:', lastRequest.keyword);
      } else {
        console.error('Search error:', error);
      }
    } finally {
      // æ¸…ç†é˜Ÿåˆ—
      this.requestQueue = [];
      this.isProcessing = false;
    }
  }

  renderResults(data) {
    // æ¸²æŸ“æœç´¢ç»“æœåˆ°UI
    console.log('Rendering results:', data);
  }
}
```

---

### æ–¹æ¡ˆ4ï¼šReact Hookå®ç°ï¼ˆç°ä»£æ–¹æ¡ˆï¼‰

```javascript
import { useState, useCallback, useRef } from 'react';

function useSearch() {
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);
  const pendingRequestsRef = useRef(new Map());
  const latestRequestIdRef = useRef(0);

  const search = useCallback(async (keyword) => {
    if (!keyword.trim()) {
      setResults([]);
      return;
    }

    // å–æ¶ˆæ‰€æœ‰è¿›è¡Œä¸­çš„è¯·æ±‚
    pendingRequestsRef.current.forEach((controller) => {
      controller.abort();
    });
    pendingRequestsRef.current.clear();

    const requestId = ++latestRequestIdRef.current;
    const controller = new AbortController();
    pendingRequestsRef.current.set(requestId, controller);

    setLoading(true);

    try {
      const response = await fetch(`/api/search?q=${encodeURIComponent(keyword)}`, {
        signal: controller.signal,
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (!response.ok) throw new Error('Search failed');

      const data = await response.json();

      // åªå¤„ç†æœ€æ–°çš„è¯·æ±‚
      if (requestId === latestRequestIdRef.current) {
        setResults(data);
      }
    } catch (error) {
      if (error.name !== 'AbortError') {
        console.error('Search error:', error);
        // å¤„ç†é”™è¯¯çŠ¶æ€
      }
    } finally {
      pendingRequestsRef.current.delete(requestId);
      if (pendingRequestsRef.current.size === 0) {
        setLoading(false);
      }
    }
  }, []);

  return { results, loading, search };
}

// ä½¿ç”¨ç¤ºä¾‹
function SearchComponent() {
  const { results, loading, search } = useSearch();

  return (
    <div>
      <input
        type="text"
        onChange={(e) => search(e.target.value)}
        placeholder="Search..."
      />
      {loading && <div>Loading...</div>}
      <ul>
        {results.map((item) => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}
```

---

## ğŸ¯ è€ƒå¯Ÿç‚¹åˆ†æ

### 1. **æŠ€æœ¯å±‚é¢**
- **è¯·æ±‚ç®¡ç†**ï¼šå¦‚ä½•å–æ¶ˆå’Œå¤„ç†å¹¶å‘è¯·æ±‚
- **å¼‚æ­¥æ§åˆ¶**ï¼šPromise/async-awaitçš„åˆç†ä½¿ç”¨
- **é˜²æŠ–èŠ‚æµ**ï¼šé˜²æ­¢è¯·æ±‚è¿‡é¢‘çš„ä¼˜åŒ–ç­–ç•¥
- **ç«æ€æ¡ä»¶**ï¼šç†è§£å’Œé¿å…å¹¶å‘é—®é¢˜

### 2. **ç”¨æˆ·ä½“éªŒ**
- **å“åº”é€Ÿåº¦**ï¼šé¿å…è¯·æ±‚é˜»å¡å½±å“äº¤äº’
- **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯æ˜¾ç¤ºæ•°æ®ä¸ç”¨æˆ·æ„å›¾ä¸€è‡´
- **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸æ—¶çš„é™çº§æ–¹æ¡ˆ

### 3. **ä»£ç è´¨é‡**
- **å¯ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
- **æ€§èƒ½è€ƒé‡**ï¼šå†…å­˜å ç”¨ã€è¯·æ±‚å¤„ç†æ•ˆç‡
- **å…¼å®¹æ€§**ï¼šä¸åŒæµè§ˆå™¨å’Œç½‘ç»œç¯å¢ƒ

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| å–æ¶ˆè¯·æ±‚ | å®ç°ç®€å•ï¼Œèµ„æºåˆ©ç”¨åˆç† | éœ€è¦ä¾èµ–å¤–éƒ¨åº“çš„å–æ¶ˆåŠŸèƒ½ | é€šç”¨æœç´¢åœºæ™¯ |
| è¯·æ±‚IDåŒ¹é… | çº¯é€»è¾‘æ§åˆ¶ï¼Œæ— å‰¯ä½œç”¨ | å¯èƒ½é€ æˆä¸å¿…è¦çš„è¯·æ±‚ | è½»é‡çº§åº”ç”¨ |
| è¯·æ±‚é˜Ÿåˆ— | æ§åˆ¶ç²¾ç»†ï¼Œé¿å…ç«æ€ | å®ç°å¤æ‚ï¼Œå¼€é”€è¾ƒå¤§ | å¤æ‚æœç´¢ç³»ç»Ÿ |
| React Hook | ç°ä»£åŒ–ï¼Œä¸æ¡†æ¶æ·±åº¦é›†æˆ | Reactä¸“å±ï¼Œå­¦ä¹ æˆæœ¬é«˜ | Reacté¡¹ç›® |

---

## ğŸš€ æœ€ä½³å®è·µå»ºè®®

### 1. **åŸºç¡€è¦æ±‚**
- å¿…é¡»å®ç°è¯·æ±‚å–æ¶ˆåŠŸèƒ½ï¼ˆAbortControlleræˆ–axios cancelTokenï¼‰
- æ·»åŠ é˜²æŠ–æœºåˆ¶ï¼ˆ300-500mså»¶è¿Ÿï¼‰
- è®°å½•è¯·æ±‚æ—¶é—´æˆ³è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯

### 2. **è¿›é˜¶ä¼˜åŒ–**
- å®ç°è¯·æ±‚ä¼˜å…ˆçº§ç®¡ç†
- æ·»åŠ è¯·æ±‚ç¼“å­˜æœºåˆ¶ï¼ˆRedis/Memoryï¼‰
- æ”¯æŒç¦»çº¿æœç´¢å’Œæœ¬åœ°ç¼“å­˜

### 3. **é”™è¯¯å¤„ç†**
- ç½‘ç»œè¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- é™çº§æ–¹æ¡ˆï¼ˆæ˜¾ç¤ºä¸Šæ¬¡æœ‰æ•ˆç»“æœï¼‰
- å‹å¥½çš„é”™è¯¯æç¤º

### 4. **æ€§èƒ½ä¼˜åŒ–**
- è¯·æ±‚é˜²æŠ–é¿å…é¢‘ç¹è§¦å‘
- ç»“æœç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚
- æ¸è¿›å¼åŠ è½½ï¼ˆåˆ†é¡µ/è™šæ‹Ÿæ»šåŠ¨ï¼‰

---

## ğŸ¢ å­—èŠ‚è·³åŠ¨å®é™…åº”ç”¨

åœ¨å­—èŠ‚çš„äº§å“ä¸­ï¼ˆå¦‚æŠ–éŸ³ã€å¤´æ¡æœç´¢ï¼‰ï¼Œæœç´¢æ¡†å¤„ç†æ›´åŠ å¤æ‚ï¼š

### æŠ–éŸ³æœç´¢ç‰¹ç‚¹
```javascript
// æŠ–éŸ³æœç´¢ç³»ç»Ÿç‰¹ç‚¹
1. **å®æ—¶æœç´¢å»ºè®®**ï¼šè¾“å…¥æ—¶å®æ—¶æ˜¾ç¤ºè”æƒ³è¯
2. **å¤šç±»å‹ç»“æœ**ï¼šè§†é¢‘ã€ç”¨æˆ·ã€éŸ³ä¹ã€è¯é¢˜ç­‰
3. **æ™ºèƒ½åŒ–æ’åº**ï¼šåŸºäºç”¨æˆ·åå¥½å’Œçƒ­åº¦
4. **ç¦»çº¿æ”¯æŒ**ï¼šæœ¬åœ°ç¼“å­˜å’Œå†å²è®°å½•

// æŠ€æœ¯æŒ‘æˆ˜
- æµ·é‡æ•°æ®çš„å¿«é€Ÿæ£€ç´¢
- æœç´¢ç»“æœä¸ªæ€§åŒ–æ’åº
- é«˜å¹¶å‘è¯·æ±‚å¤„ç†
- è·¨å¹³å°ä¸€è‡´æ€§
```

### å¤´æ¡æœç´¢ç‰¹ç‚¹
```javascript
// å¤´æ¡æœç´¢ç³»ç»Ÿç‰¹ç‚¹
1. **å¤šåª’ä½“æœç´¢**ï¼šå›¾æ–‡ã€è§†é¢‘ã€æ–‡ç« æ··åˆ
2. **AIæ¨è**ï¼šåŸºäºå†…å®¹ç†è§£çš„æ™ºèƒ½æ¨è
3. **çƒ­ç‚¹è¿½è¸ª**ï¼šå®æ—¶æ–°é—»å’Œçƒ­ç‚¹è¯é¢˜
4. **å¤šè¯­è¨€æ”¯æŒ**ï¼šå›½é™…åŒ–æœç´¢èƒ½åŠ›

// æŠ€æœ¯å®ç°
- å¤šæºæ•°æ®èšåˆ
- å®æ—¶ç´¢å¼•æ›´æ–°
- è¯­ä¹‰ç†è§£å¤„ç†
- åˆ†å¸ƒå¼ç¼“å­˜
```

---

## âœ¨ æ‰©å±•æ€è€ƒ

### å¦‚æœæ‰©å±•åˆ°ä¼ä¸šçº§åº”ç”¨
```javascript
class EnterpriseSearchService {
  constructor() {
    this.strategies = {
      'simple': this.simpleStrategy,
      'debounce': this.debounceStrategy,
      'queue': this.queueStrategy,
      'priority': this.priorityStrategy,
    };
  }

  // ç­–ç•¥æ¨¡å¼åº”å¯¹ä¸åŒåœºæ™¯
  search(keyword, strategy = 'debounce') {
    const selectedStrategy = this.strategies[strategy];
    return selectedStrategy(keyword);
  }

  // ç›‘æ§æŒ‡æ ‡
  getMetrics() {
    return {
      totalRequests: this.totalRequests,
      canceledRequests: this.canceledRequests,
      avgResponseTime: this.avgResponseTime,
      errorRate: this.errorRate,
    };
  }
}
```

---

## ğŸ“ å¸¸è§é”™è¯¯

### âŒ é”™è¯¯ç¤ºä¾‹
```javascript
// é”™è¯¯ï¼šç«æ€æ¡ä»¶ï¼ˆåå‘å…ˆè‡³ï¼‰
async function searchFlawed(keyword) {
  const result = await fetch(`/api/search?q=${keyword}`);
  setSearchResults(await result.json()); // å¯èƒ½æ˜¾ç¤ºæ—§æ•°æ®
}
```

### âœ… æ­£ç¡®æ€è·¯
1. **å–æ¶ˆæ—§è¯·æ±‚**ï¼šä½¿ç”¨AbortControlleræˆ–cancelToken
2. **æ—¶åºæ§åˆ¶**ï¼šè®°å½•è¯·æ±‚æ—¶é—´æˆ³æˆ–ID
3. **çŠ¶æ€éªŒè¯**ï¼šè¿”å›å‰æ£€æŸ¥æ˜¯å¦ä¸ºæœ€æ–°è¯·æ±‚
4. **é˜²æŠ–ä¼˜åŒ–**ï¼šé¿å…è¯·æ±‚è¿‡é¢‘

---

**æœ¬é¢˜æ¥æº**ï¼šå­—èŠ‚è·³åŠ¨çœŸå®é¢è¯•é¢˜ï¼ˆæ˜é‡‘é¢ç»ä½œè€…ï¼š3800ï¼‰
**éš¾åº¦è¯„çº§**ï¼šâ­â­â­â­ï¼ˆé«˜çº§åœºæ™¯é¢˜ï¼‰
**å…¬å¸æ ‡ç­¾**ï¼šå­—èŠ‚è·³åŠ¨ã€è…¾è®¯ã€é˜¿é‡Œ